---
title: Spring Boot + WebSocket 推送好友动态消息
date: 2018-05-31 09:34:34
tags:
---
## 背景

最近一个项目中一个功能需求是这样的：类似于 QQ 空间的评论、点赞通知功能，需要实时推送消息，第一时间我的脑海里想到的就是 WebSocket。

心急的朋友可以直接滑动滚动条到下方，文章前面是一些基本介绍。

## 为什么是 WebSocket ?

HTTP 协议的特性我们都已经清楚了，客户端浏览器向 HTTP 服务器发送请求，继而 HTTP 服务器将相应的资源发回给客户端这样一个过程中，无论对于客户端还是服务器，都没有必要记录这个过程。

如果我们需要服务端主动向客户端发送消息时就懵了，因为无状态的特性，我们的服务器无法找到上一次访问的客户端。

聪明的人应该想到一种方法：客户端需要显示实时消息推送，我在后台提供一个接口，前端通过 ajax 轮训这个接口，一旦接口有数据返回，前端就渲染。这样的做法既简单，又方便，很多程序员喜欢这种写法，但是这样做真的好吗？

ajax 轮训的本质就是 HTTP 请求，如果需要实时性高的比如在业务产生的瞬间就能得到消息推送，怎么办？调低轮训时间？显然性能就直接下降了。这时候，我们的 WebSocket 就出场了！

## 什么是 WebSocket ?

> WebSocket 协议是基于TCP的一种新的网络协议。它实现了浏览器与服务器全双工(full-duplex)通信——允许服务器主动发送信息给客户端。 -- 百度百科

WebSocket 的定义已经很明确了，请注意，上面提到的是：“全双工”，全双工的意思是服务器与客户端可以同时发送消息，也可以同时接受消息。

> 在实现 Websocket 连线过程中，需要通过浏览器发出 Websocket 连线请求，然后服务器发出回应，这个过程通常称为“握手” 。在 WebSocket API，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。 -- 百度百科

服务器与客户端建立了一条连线，这样他们就可以来发送消息了，只要服务器有数据变化就通知客户端。这里要注意的是，客户端与服务器建立的是**一条**连接！

## 开始吧！

在开始之前，您需要有 Spring Boot 的基础。